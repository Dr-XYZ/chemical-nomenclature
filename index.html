<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>åŒ–å­¸è‹±æ–‡å‘½åç·´ç¿’</title>
  <style>
body {
  font-family: Arial, sans-serif;
  background: #f2f5f9;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}

.container {
  background: white;
  padding: 1rem;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 480px;
  margin: 0.5rem;
}

h1 {
  font-size: 1.4rem;
  margin-bottom: 1rem;
  text-align: center;
}

#question {
  font-size: 1.5rem;
  margin-bottom: 1rem;
}

.options {
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

button.option {
  padding: 1rem;
  border: none;
  border-radius: 8px;
  background: #f0f0f0;
  cursor: pointer;
  font-size: 1.1rem;
  transition: transform 0.15s, background 0.2s;
  width: 100%;
}

button.option:hover {
  background: #e0e0e0;
  transform: scale(1.02);
}

.correct { background: #a6e3a1 !important; }
.wrong { background: #f6a6a6 !important; }

.progress-bar {
  margin-top: 1rem;
  height: 14px;
  background: #ddd;
  border-radius: 7px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: #4a90e2;
  width: 0%;
  transition: width 0.3s;
}

.footer {
  margin-top: 0.8rem;
  display: flex;
  justify-content: space-between;
  font-size: 1rem;
}

button.control {
  margin-top: 1rem;
  padding: 0.8rem 1rem;
  border: none;
  border-radius: 6px;
  background: #4a90e2;
  color: white;
  cursor: pointer;
  width: 100%;
}

/* ğŸ“± æ‰‹æ©Ÿå°ˆå±¬å„ªåŒ– */
@media (max-width: 600px) {
  h1 { font-size: 1.2rem; }
  #question { font-size: 1.3rem; }
  button.option { font-size: 1rem; padding: 0.9rem; }
  .container { padding: 0.8rem; margin: 0.3rem; }
}
  </style>
</head>
<body>
  <div class="container">
    <h1>åŒ–å­¸è‹±æ–‡å‘½åç·´ç¿’</h1>
    <select id="categorySelect"></select>
    <div id="quiz" class="hidden">
      <h2 id="question">é¡Œç›®è¼‰å…¥ä¸­...</h2>
      <div class="options" id="options"></div>
      <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
      <div class="footer">
        <span id="progress">0/0</span>
        <span id="score">åˆ†æ•¸: 0</span>
      </div>
      <button class="control" onclick="showHint()">æç¤º</button>
      <div id="endScreen" class="end-screen hidden"></div>
    </div>
  </div>

  <script>
    let allData = [];
    let quizData = [];
    let wrongQuestions = [];
    let current = 0, correct = 0, score = 0;
    let hintUsed = false;

    async function loadCSV() {
      const response = await fetch("questions.csv");
      const text = await response.text();
      const rows = text.trim().split("\n").slice(1);
      allData = rows.map(row => {
        const cols = row.split(",");
        return {
          category: cols[0],
          q: cols[1],
          a: cols[2],
          options: cols.slice(3)
        };
      });
      initCategorySelect();
    }

    function initCategorySelect() {
      const select = document.getElementById("categorySelect");
      const categories = [...new Set(allData.map(d => d.category))];
      select.innerHTML = "<option value=''>è«‹é¸æ“‡é¡Œåº«åˆ†é¡</option>" +
        categories.map(c => `<option value="${c}">${c}</option>`).join("");
      select.onchange = () => startQuiz(select.value);
    }

    function startQuiz(category, useWrong = false) {
      if (!category && !useWrong) return;
      quizData = useWrong ? wrongQuestions : allData.filter(d => d.category === category);
      current = 0; correct = 0; score = 0; wrongQuestions = [];
      document.getElementById("quiz").classList.remove("hidden");
      document.getElementById("endScreen").classList.add("hidden");
      loadQuestion();
    }

    function loadQuestion() {
      const data = quizData[current];
      document.getElementById("question").innerText = `é¡Œç›®ï¼š${data.q}`;
      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";
      hintUsed = false;

      data.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "option";
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(btn, opt);
        optionsDiv.appendChild(btn);
      });
      updateProgress();
    }

    function checkAnswer(btn, answer) {
      const data = quizData[current];
      if (answer === data.a) {
        btn.classList.add("correct");
        correct++;
        score += hintUsed ? 5 : 10;
      } else {
        btn.classList.add("wrong");
        score -= 5;
        wrongQuestions.push(data);
        [...document.querySelectorAll(".option")]
          .find(b => b.innerText === data.a).classList.add("correct");
      }
      setTimeout(() => {
        current++;
        if (current < quizData.length) {
          loadQuestion();
        } else {
          showEndScreen();
        }
      }, 1000);
      updateProgress();
    }

    function updateProgress() {
      document.getElementById("progress").innerText = `${current}/${quizData.length}`;
      document.getElementById("score").innerText = `åˆ†æ•¸: ${score}`;
      document.getElementById("progressFill").style.width = `${(current/quizData.length)*100}%`;
    }

    function showHint() {
      const data = quizData[current];
      if (hintUsed) return;
      hintUsed = true;
      document.getElementById("question").innerText = 
        `é¡Œç›®ï¼š${data.q} â†’ æç¤ºï¼š${data.a[0]}${"_".repeat(data.a.length-2)}${data.a[data.a.length-1]}`;
    }

    function showEndScreen() {
      document.getElementById("question").innerText =
        `ç·´ç¿’å®Œæˆï¼æ­£ç¢ºç‡ ${(correct/quizData.length*100).toFixed(0)}%`;
      document.getElementById("options").innerHTML = "";
      const endScreen = document.getElementById("endScreen");
      endScreen.classList.remove("hidden");
      endScreen.innerHTML = "";

      if (wrongQuestions.length > 0) {
        const wrongBtn = document.createElement("button");
        wrongBtn.className = "control";
        wrongBtn.innerText = `é‡ç·´éŒ¯é¡Œ (${wrongQuestions.length})`;
        wrongBtn.onclick = () => startQuiz("", true);
        endScreen.appendChild(wrongBtn);
      }

      const restartBtn = document.createElement("button");
      restartBtn.className = "control";
      restartBtn.innerText = "å›åˆ°åˆ†é¡é¸æ“‡";
      restartBtn.onclick = () => location.reload();
      endScreen.appendChild(restartBtn);
    }

    loadCSV();
  </script>
</body>
</html>